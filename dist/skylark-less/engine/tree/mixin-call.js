/**
 * skylark-less - A version of less.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-less/
 * @license MIT
 */
define(["./node","./selector","./mixin-definition","../functions/default"],function(e,t,i,n){"use strict";var r={},s={exports:{}},o=t,a=i,l=n,f=function(e,t,i,n,r){this.selector=new o(e),this.arguments=t||[],this._index=i,this._fileInfo=n,this.important=r,this.allowRoot=!0,this.setParent(this.selector,this)};function u(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return(f.prototype=new e).type="MixinCall",f.prototype.accept=function(e){this.selector&&(this.selector=e.visit(this.selector)),this.arguments.length&&(this.arguments=e.visitArray(this.arguments))},f.prototype.eval=function(e){var t,i,n,r,s,o,f,u,h,m,c,p,g,d,y,v=[],x=[],C=!1,I=[],b=[],w=-1,A=0,R=1,S=2;function k(t,i){var n,r,s;for(n=0;n<2;n++){for(b[n]=!0,l.value(n),r=0;r<i.length&&b[n];r++)(s=i[r]).matchCondition&&(b[n]=b[n]&&s.matchCondition(null,e));t.matchCondition&&(b[n]=b[n]&&t.matchCondition(v,e))}return b[0]||b[1]?b[0]!=b[1]?b[1]?R:S:A:w}for(this.selector=this.selector.eval(e),o=0;o<this.arguments.length;o++)if(s=(r=this.arguments[o]).value.eval(e),r.expand&&Array.isArray(s.value))for(s=s.value,f=0;f<s.length;f++)v.push({value:s[f]});else v.push({name:r.name,value:s});for(y=function(t){return t.matchArgs(null,e)},o=0;o<e.frames.length;o++)if((t=e.frames[o].find(this.selector,null,y)).length>0){for(m=!0,f=0;f<t.length;f++){for(i=t[f].rule,n=t[f].path,h=!1,u=0;u<e.frames.length;u++)if(!(i instanceof a)&&i===(e.frames[u].originalRuleset||e.frames[u])){h=!0;break}h||i.matchArgs(v,e)&&((c={mixin:i,group:k(i,n)}).group!==w&&I.push(c),C=!0)}for(l.reset(),g=[0,0,0],f=0;f<I.length;f++)g[I[f].group]++;if(g[A]>0)p=S;else if(p=R,g[R]+g[S]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(v)+"`",index:this.getIndex(),filename:this.fileInfo().filename};for(f=0;f<I.length;f++)if((c=I[f].group)===A||c===p)try{(i=I[f].mixin)instanceof a||(d=i.originalRuleset||i,(i=new a("",[],i.rules,null,!1,null,d.visibilityInfo())).originalRuleset=d);var V=i.evalCall(e,v,this.important).rules;this._setVisibilityToReplacement(V),Array.prototype.push.apply(x,V)}catch(e){throw{message:e.message,index:this.getIndex(),filename:this.fileInfo().filename,stack:e.stack}}if(C)return x}throw m?{type:"Runtime",message:"No matching definition was found for `"+this.format(v)+"`",index:this.getIndex(),filename:this.fileInfo().filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.getIndex(),filename:this.fileInfo().filename}},f.prototype._setVisibilityToReplacement=function(e){var t;if(this.blocksVisibility())for(t=0;t<e.length;t++)e[t].addVisibilityBlock()},f.prototype.format=function(e){return this.selector.toCSS().trim()+"("+(e?e.map(function(e){var t="";return e.name&&(t+=e.name+":"),e.value.toCSS?t+=e.value.toCSS():t+="???",t}).join(", "):"")+")"},s.exports=f,u(s.exports)?s.exports:u(r)?r:void 0});
//# sourceMappingURL=../../sourcemaps/engine/tree/mixin-call.js.map
