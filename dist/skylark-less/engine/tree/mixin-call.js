/**
 * skylark-less - A version of less.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-less/
 * @license MIT
 */
var Node=require("./node"),Selector=require("./selector"),MixinDefinition=require("./mixin-definition"),defaultFunc=require("../functions/default"),MixinCall=function(e,i,t,n,l){this.selector=new Selector(e),this.arguments=i||[],this._index=t,this._fileInfo=n,this.important=l,this.allowRoot=!0,this.setParent(this.selector,this)};MixinCall.prototype=new Node,MixinCall.prototype.type="MixinCall",MixinCall.prototype.accept=function(e){this.selector&&(this.selector=e.visit(this.selector)),this.arguments.length&&(this.arguments=e.visitArray(this.arguments))},MixinCall.prototype.eval=function(e){var i,t,n,l,o,s,r,a,f,u,h,m,c,g,p,d=[],x=[],y=!1,v=[],C=[],M=-1,I=0,S=1,w=2;function b(i,t){var n,l,o;for(n=0;n<2;n++){for(C[n]=!0,defaultFunc.value(n),l=0;l<t.length&&C[n];l++)(o=t[l]).matchCondition&&(C[n]=C[n]&&o.matchCondition(null,e));i.matchCondition&&(C[n]=C[n]&&i.matchCondition(d,e))}return C[0]||C[1]?C[0]!=C[1]?C[1]?S:w:I:M}for(this.selector=this.selector.eval(e),s=0;s<this.arguments.length;s++)if(o=(l=this.arguments[s]).value.eval(e),l.expand&&Array.isArray(o.value))for(o=o.value,r=0;r<o.length;r++)d.push({value:o[r]});else d.push({name:l.name,value:o});for(p=function(i){return i.matchArgs(null,e)},s=0;s<e.frames.length;s++)if((i=e.frames[s].find(this.selector,null,p)).length>0){for(u=!0,r=0;r<i.length;r++){for(t=i[r].rule,n=i[r].path,f=!1,a=0;a<e.frames.length;a++)if(!(t instanceof MixinDefinition)&&t===(e.frames[a].originalRuleset||e.frames[a])){f=!0;break}f||t.matchArgs(d,e)&&((h={mixin:t,group:b(t,n)}).group!==M&&v.push(h),y=!0)}for(defaultFunc.reset(),c=[0,0,0],r=0;r<v.length;r++)c[v[r].group]++;if(c[I]>0)m=w;else if(m=S,c[S]+c[w]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(d)+"`",index:this.getIndex(),filename:this.fileInfo().filename};for(r=0;r<v.length;r++)if((h=v[r].group)===I||h===m)try{(t=v[r].mixin)instanceof MixinDefinition||(g=t.originalRuleset||t,(t=new MixinDefinition("",[],t.rules,null,!1,null,g.visibilityInfo())).originalRuleset=g);var R=t.evalCall(e,d,this.important).rules;this._setVisibilityToReplacement(R),Array.prototype.push.apply(x,R)}catch(e){throw{message:e.message,index:this.getIndex(),filename:this.fileInfo().filename,stack:e.stack}}if(y)return x}throw u?{type:"Runtime",message:"No matching definition was found for `"+this.format(d)+"`",index:this.getIndex(),filename:this.fileInfo().filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.getIndex(),filename:this.fileInfo().filename}},MixinCall.prototype._setVisibilityToReplacement=function(e){var i;if(this.blocksVisibility())for(i=0;i<e.length;i++)e[i].addVisibilityBlock()},MixinCall.prototype.format=function(e){return this.selector.toCSS().trim()+"("+(e?e.map(function(e){var i="";return e.name&&(i+=e.name+":"),e.value.toCSS?i+=e.value.toCSS():i+="???",i}).join(", "):"")+")"},module.exports=MixinCall;
//# sourceMappingURL=../../sourcemaps/engine/tree/mixin-call.js.map
