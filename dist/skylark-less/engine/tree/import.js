/**
 * skylark-less - A version of less.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-less/
 * @license MIT
 */
define(["./node","./media","./url","./quoted","./ruleset","./anonymous","../utils","../less-error"],function(t,i,e,s,o,r,n,h){"use strict";var a={},f={exports:{}},u=i,l=e,p=s,c=o,v=r,d=n,y=h,m=function(t,i,e,s,o,r){if(this.options=e,this._index=s,this._fileInfo=o,this.path=t,this.features=i,this.allowRoot=!0,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var n=this.getPath();n&&/[#\.\&\?]css([\?;].*)?$/.test(n)&&(this.css=!0)}this.copyVisibilityInfo(r),this.setParent(this.features,this),this.setParent(this.path,this)};function g(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var i;for(i in t)return!1;return!0}(t)}return(m.prototype=new t).type="Import",m.prototype.accept=function(t){this.features&&(this.features=t.visit(this.features)),this.path=t.visit(this.path),this.options.isPlugin||this.options.inline||!this.root||(this.root=t.visit(this.root))},m.prototype.genCSS=function(t,i){this.css&&void 0===this.path._fileInfo.reference&&(i.add("@import ",this._fileInfo,this._index),this.path.genCSS(t,i),this.features&&(i.add(" "),this.features.genCSS(t,i)),i.add(";"))},m.prototype.getPath=function(){return this.path instanceof l?this.path.value.value:this.path.value},m.prototype.isVariableImport=function(){var t=this.path;return t instanceof l&&(t=t.value),!(t instanceof p)||t.containsVariables()},m.prototype.evalForImport=function(t){var i=this.path;return i instanceof l&&(i=i.value),new m(i.eval(t),this.features,this.options,this._index,this._fileInfo,this.visibilityInfo())},m.prototype.evalPath=function(t){var i=this.path.eval(t),e=this._fileInfo;if(!(i instanceof l)){var s=i.value;e&&s&&t.pathRequiresRewrite(s)?i.value=t.rewritePath(s,e.rootpath):i.value=t.normalizePath(i.value)}return i},m.prototype.eval=function(t){var i=this.doEval(t);return(this.options.reference||this.blocksVisibility())&&(i.length||0===i.length?i.forEach(function(t){t.addVisibilityBlock()}):i.addVisibilityBlock()),i},m.prototype.doEval=function(t){var i,e,s=this.features&&this.features.eval(t);if(this.options.isPlugin){if(this.root&&this.root.eval)try{this.root.eval(t)}catch(t){throw t.message="Plugin error during evaluation",new y(t,this.root.imports,this.root.filename)}return(e=t.frames[0]&&t.frames[0].functionRegistry)&&this.root&&this.root.functions&&e.addMultiple(this.root.functions),[]}if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var o=new v(this.root,0,{filename:this.importedFilename,reference:this.path._fileInfo&&this.path._fileInfo.reference},!0,!0);return this.features?new u([o],this.features.value):[o]}if(this.css){var r=new m(this.evalPath(t),s,this.options,this._index);if(!r.css&&this.error)throw this.error;return r}return(i=new c(null,d.copyArray(this.root.rules))).evalImports(t),this.features?new u(i.rules,this.features.value):i.rules},f.exports=m,g(f.exports)?f.exports:g(a)?a:void 0});
//# sourceMappingURL=../../sourcemaps/engine/tree/import.js.map
