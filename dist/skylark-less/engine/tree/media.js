/**
 * skylark-less - A version of less.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-less/
 * @license MIT
 */
define(["./ruleset","./value","./selector","./anonymous","./expression","./atrule","../utils"],function(e,t,i,s,r,n,o){"use strict";var u={},a={exports:{}},h=e,l=t,f=i,p=s,c=r,d=o,y=function(e,t,i,s,r){this._index=i,this._fileInfo=s;var n=new f([],null,null,this._index,this._fileInfo).createEmptySelectors();this.features=new l(t),this.rules=[new h(n,e)],this.rules[0].allowImports=!0,this.copyVisibilityInfo(r),this.allowRoot=!0,this.setParent(n,this),this.setParent(this.features,this),this.setParent(this.rules,this)};function m(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return(y.prototype=new n).type="Media",y.prototype.isRulesetLike=function(){return!0},y.prototype.accept=function(e){this.features&&(this.features=e.visit(this.features)),this.rules&&(this.rules=e.visitArray(this.rules))},y.prototype.genCSS=function(e,t){t.add("@media ",this._fileInfo,this._index),this.features.genCSS(e,t),this.outputRuleset(e,t,this.rules)},y.prototype.eval=function(e){e.mediaBlocks||(e.mediaBlocks=[],e.mediaPath=[]);var t=new y(null,[],this._index,this._fileInfo,this.visibilityInfo());return this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,t.debugInfo=this.debugInfo),t.features=this.features.eval(e),e.mediaPath.push(t),e.mediaBlocks.push(t),this.rules[0].functionRegistry=e.frames[0].functionRegistry.inherit(),e.frames.unshift(this.rules[0]),t.rules=[this.rules[0].eval(e)],e.frames.shift(),e.mediaPath.pop(),0===e.mediaPath.length?t.evalTop(e):t.evalNested(e)},y.prototype.evalTop=function(e){var t=this;if(e.mediaBlocks.length>1){var i=new f([],null,null,this.getIndex(),this.fileInfo()).createEmptySelectors();(t=new h(i,e.mediaBlocks)).multiMedia=!0,t.copyVisibilityInfo(this.visibilityInfo()),this.setParent(t,this)}return delete e.mediaBlocks,delete e.mediaPath,t},y.prototype.evalNested=function(e){var t,i,s=e.mediaPath.concat([this]);for(t=0;t<s.length;t++)i=s[t].features instanceof l?s[t].features.value:s[t].features,s[t]=Array.isArray(i)?i:[i];return this.features=new l(this.permute(s).map(function(e){for(e=e.map(function(e){return e.toCSS?e:new p(e)}),t=e.length-1;t>0;t--)e.splice(t,0,new p("and"));return new c(e)})),this.setParent(this.features,this),new h([],[])},y.prototype.permute=function(e){if(0===e.length)return[];if(1===e.length)return e[0];for(var t=[],i=this.permute(e.slice(1)),s=0;s<i.length;s++)for(var r=0;r<e[0].length;r++)t.push([e[0][r]].concat(i[s]));return t},y.prototype.bubbleSelectors=function(e){e&&(this.rules=[new h(d.copyArray(e),[this.rules[0]])],this.setParent(this.rules,this))},a.exports=y,m(a.exports)?a.exports:m(u)?u:void 0});
//# sourceMappingURL=../../sourcemaps/engine/tree/media.js.map
