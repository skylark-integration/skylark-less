/**
 * skylark-less - A version of less.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-less/
 * @license MIT
 */
define(["./selector","./element","./ruleset","./declaration","./detached-ruleset","./expression","../contexts","../utils"],function(e,t,r,i,a,n,s,o){"use strict";var l={},u={exports:{}},h=e,m=t,f=r,c=i,p=a,v=n,y=s,d=o,w=function(e,t,r,i,a,n,s){this.name=e||"anonymous mixin",this.selectors=[new h([new m(null,e,!1,this._index,this._fileInfo)])],this.params=t,this.condition=i,this.variadic=a,this.arity=t.length,this.rules=r,this._lookups={};var o=[];this.required=t.reduce(function(e,t){return!t.name||t.name&&!t.value?e+1:(o.push(t.name),e)},0),this.optionalParameters=o,this.frames=n,this.copyVisibilityInfo(s),this.allowRoot=!0};function g(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return(w.prototype=new f).type="MixinDefinition",w.prototype.evalFirst=!0,w.prototype.accept=function(e){this.params&&this.params.length&&(this.params=e.visitArray(this.params)),this.rules=e.visitArray(this.rules),this.condition&&(this.condition=e.visit(this.condition))},w.prototype.evalParams=function(e,t,r,i){var a,n,s,o,l,u,h,m,w=new f(null,null),g=d.copyArray(this.params),A=0;if(t.frames&&t.frames[0]&&t.frames[0].functionRegistry&&(w.functionRegistry=t.frames[0].functionRegistry.inherit()),t=new y.Eval(t,[w].concat(t.frames)),r)for(A=(r=d.copyArray(r)).length,s=0;s<A;s++)if(u=(n=r[s])&&n.name){for(h=!1,o=0;o<g.length;o++)if(!i[o]&&u===g[o].name){i[o]=n.value.eval(e),w.prependRule(new c(u,n.value.eval(e))),h=!0;break}if(h){r.splice(s,1),s--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+r[s].name+" not found"}}for(m=0,s=0;s<g.length;s++)if(!i[s]){if(n=r&&r[m],u=g[s].name)if(g[s].variadic){for(a=[],o=m;o<A;o++)a.push(r[o].value.eval(e));w.prependRule(new c(u,new v(a).eval(e)))}else{if(l=n&&n.value)l=Array.isArray(l)?new p(new f("",l)):l.eval(e);else{if(!g[s].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+A+" for "+this.arity+")"};l=g[s].value.eval(t),w.resetCache()}w.prependRule(new c(u,l)),i[s]=l}if(g[s].variadic&&r)for(o=m;o<A;o++)i[o]=r[o].value.eval(e);m++}return w},w.prototype.makeImportant=function(){var e=this.rules?this.rules.map(function(e){return e.makeImportant?e.makeImportant(!0):e}):this.rules;return new w(this.name,this.params,e,this.condition,this.variadic,this.frames)},w.prototype.eval=function(e){return new w(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||d.copyArray(e.frames))},w.prototype.evalCall=function(e,t,r){var i,a,n=[],s=this.frames?this.frames.concat(e.frames):e.frames,o=this.evalParams(e,new y.Eval(e,s),t,n);return o.prependRule(new c("@arguments",new v(n).eval(e))),i=d.copyArray(this.rules),(a=new f(null,i)).originalRuleset=this,a=a.eval(new y.Eval(e,[this,o].concat(s))),r&&(a=a.makeImportant()),a},w.prototype.matchCondition=function(e,t){return!(this.condition&&!this.condition.eval(new y.Eval(t,[this.evalParams(t,new y.Eval(t,this.frames?this.frames.concat(t.frames):t.frames),e,[])].concat(this.frames||[]).concat(t.frames))))},w.prototype.matchArgs=function(e,t){var r,i=e&&e.length||0,a=this.optionalParameters,n=e?e.reduce(function(e,t){return a.indexOf(t.name)<0?e+1:e},0):0;if(this.variadic){if(n<this.required-1)return!1}else{if(n<this.required)return!1;if(i>this.params.length)return!1}r=Math.min(n,this.arity);for(var s=0;s<r;s++)if(!this.params[s].name&&!this.params[s].variadic&&e[s].value.eval(t).toCSS()!=this.params[s].value.eval(t).toCSS())return!1;return!0},u.exports=w,g(u.exports)?u.exports:g(l)?l:void 0});
//# sourceMappingURL=../../sourcemaps/engine/tree/mixin-definition.js.map
