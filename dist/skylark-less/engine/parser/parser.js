/**
 * skylark-less - A version of less.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-less/
 * @license MIT
 */
var LessError=require("../less-error"),tree=require("../tree"),visitors=require("../visitors"),getParserInput=require("./parser-input"),utils=require("../utils"),functionRegistry=require("../functions/function-registry"),Parser=function e(r,t,n){var i,o=getParserInput();function a(e,r){throw new LessError({index:o.i,filename:n.filename,type:r||"Syntax",message:e},t)}function s(e,r){var t=e instanceof Function?e.call(i):o.$re(e);if(t)return t;a(r||("string"==typeof e?"expected '"+e+"' got '"+o.currentChar()+"'":"unexpected token"))}function u(e,r){if(o.$char(e))return e;a(r||"expected '"+e+"' got '"+o.currentChar()+"'")}function l(e){var r=n.filename;return{lineNumber:utils.getLocation(e,o.getInput()).line+1,fileName:r}}return{parserInput:o,imports:t,fileInfo:n,parseNode:function(e,r,n,a,s){var u,l=[],c=o;try{c.start(e,!1,function(e,r){s({message:e,index:r+n})});for(var f,h,p=0;f=r[p];p++)h=c.i,(u=i[f]())?(u._index=h+n,u._fileInfo=a,l.push(u)):l.push(null);c.end().isFinished?s(null,l):s(!0,null)}catch(e){throw new LessError({index:e.index+n,message:e.message},t,a.filename)}},parse:function(i,a,s){var u,l,c,f,h=null,p="";if(l=s&&s.globalVars?e.serializeVars(s.globalVars)+"\n":"",c=s&&s.modifyVars?"\n"+e.serializeVars(s.modifyVars):"",r.pluginManager)for(var d=r.pluginManager.getPreProcessors(),m=0;m<d.length;m++)i=d[m].process(i,{context:r,imports:t,fileInfo:n});(l||s&&s.banner)&&(p=(s&&s.banner?s.banner:"")+l,(f=t.contentsIgnoredChars)[n.filename]=f[n.filename]||0,f[n.filename]+=p.length),i=p+(i=i.replace(/\r\n?/g,"\n")).replace(/^\uFEFF/,"")+c,t.contents[n.filename]=i;try{o.start(i,r.chunkInput,function(e,r){throw new LessError({index:r,type:"Parse",message:e,filename:n.filename},t)}),tree.Node.prototype.parse=this,u=new tree.Ruleset(null,this.parsers.primary()),tree.Node.prototype.rootNode=u,u.root=!0,u.firstRoot=!0,u.functionRegistry=functionRegistry.inherit()}catch(e){return a(new LessError(e,t,n.filename))}var v=o.end();if(!v.isFinished){var g=v.furthestPossibleErrorMessage;g||(g="Unrecognised input","}"===v.furthestChar?g+=". Possibly missing opening '{'":")"===v.furthestChar?g+=". Possibly missing opening '('":v.furthestReachedEnd&&(g+=". Possibly missing something")),h=new LessError({type:"Parse",message:g,index:v.furthest,filename:n.filename},t)}var w=function(e){return(e=h||e||t.error)?(e instanceof LessError||(e=new LessError(e,t,n.filename)),a(e)):a(null,u)};if(!1===r.processImports)return w();new visitors.ImportVisitor(t,w).run(u)},parsers:i={primary:function(){for(var e,r=this.mixin,t=[];;){for(;e=this.comment();)t.push(e);if(o.finished)break;if(o.peek("}"))break;if(e=this.extendRule())t=t.concat(e);else if(e=r.definition()||this.declaration()||this.ruleset()||r.call(!1,!1)||this.variableCall()||this.entities.call()||this.atrule())t.push(e);else{for(var n=!1;o.$char(";");)n=!0;if(!n)break}}return t},comment:function(){if(o.commentStore.length){var e=o.commentStore.shift();return new tree.Comment(e.text,e.isLineComment,e.index,n)}},entities:{mixinLookup:function(){return i.mixin.call(!0,!0)},quoted:function(e){var r,t=o.i,i=!1;if(o.save(),o.$char("~"))i=!0;else if(e)return void o.restore();if(r=o.$quoted())return o.forget(),new tree.Quoted(r.charAt(0),r.substr(1,r.length-2),i,t,n);o.restore()},keyword:function(){var e=o.$char("%")||o.$re(/^\[?(?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+\]?/);if(e)return tree.Color.fromKeyword(e)||new tree.Keyword(e)},call:function(){var e,r,t,i=o.i;if(!o.peek(/^url\(/i))if(o.save(),e=o.$re(/^([\w-]+|%|progid:[\w\.]+)\(/)){if(e=e[1],(t=this.customFuncCall(e))&&(r=t.parse())&&t.stop)return o.forget(),r;if(r=this.arguments(r),o.$char(")"))return o.forget(),new tree.Call(e,r,i,n);o.restore("Could not parse call arguments or missing ')'")}else o.forget()},customFuncCall:function(e){return{alpha:r(i.ieAlpha,!0),boolean:r(t),if:r(t)}[e.toLowerCase()];function r(e,r){return{parse:e,stop:r}}function t(){return[s(i.condition,"expected condition")]}},arguments:function(e){var r,t,n=e||[],a=[];for(o.save();;){if(e)e=!1;else{if(!(t=i.detachedRuleset()||this.assignment()||i.expression()))break;t.value&&1==t.value.length&&(t=t.value[0]),n.push(t)}o.$char(",")||(o.$char(";")||r)&&(r=!0,t=n.length<1?n[0]:new tree.Value(n),a.push(t),n=[])}return o.forget(),r?a:n},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var e,r;if(o.save(),e=o.$re(/^\w+(?=\s?=)/i))if(o.$char("=")){if(r=i.entity())return o.forget(),new tree.Assignment(e,r);o.restore()}else o.restore();else o.restore()},url:function(){var e,r=o.i;if(o.autoCommentAbsorb=!1,o.$str("url("))return e=this.quoted()||this.variable()||this.property()||o.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",o.autoCommentAbsorb=!0,u(")"),new tree.URL(null!=e.value||e instanceof tree.Variable||e instanceof tree.Property?e:new tree.Anonymous(e,r),r,n);o.autoCommentAbsorb=!0},variable:function(){var e,r,t=o.i;if(o.save(),"@"===o.currentChar()&&(r=o.$re(/^@@?[\w-]+/))){if("("===(e=o.currentChar())||"["===e&&!o.prevChar().match(/^\s/)){var a=i.variableCall(r);if(a)return o.forget(),a}return o.forget(),new tree.Variable(r,t,n)}o.restore()},variableCurly:function(){var e,r=o.i;if("@"===o.currentChar()&&(e=o.$re(/^@\{([\w-]+)\}/)))return new tree.Variable("@"+e[1],r,n)},property:function(){var e,r=o.i;if("$"===o.currentChar()&&(e=o.$re(/^\$[\w-]+/)))return new tree.Property(e,r,n)},propertyCurly:function(){var e,r=o.i;if("$"===o.currentChar()&&(e=o.$re(/^\$\{([\w-]+)\}/)))return new tree.Property("$"+e[1],r,n)},color:function(){var e;if("#"===o.currentChar()&&(e=o.$re(/^#([A-Fa-f0-9]{8}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3,4})/)))return new tree.Color(e[1],void 0,e[0])},colorKeyword:function(){o.save();var e=o.autoCommentAbsorb;o.autoCommentAbsorb=!1;var r=o.$re(/^[_A-Za-z-][_A-Za-z0-9-]+/);if(o.autoCommentAbsorb=e,r){o.restore();var t=tree.Color.fromKeyword(r);return t?(o.$str(r),t):void 0}o.forget()},dimension:function(){if(!o.peekNotNumeric()){var e=o.$re(/^([+-]?\d*\.?\d+)(%|[a-z_]+)?/i);return e?new tree.Dimension(e[1],e[2]):void 0}},unicodeDescriptor:function(){var e;if(e=o.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/))return new tree.UnicodeDescriptor(e[0])},javascript:function(){var e,r=o.i;o.save();var t=o.$char("~");if(o.$char("`")){if(e=o.$re(/^[^`]*`/))return o.forget(),new tree.JavaScript(e.substr(0,e.length-1),Boolean(t),r,n);o.restore("invalid javascript definition")}else o.restore()}},variable:function(){var e;if("@"===o.currentChar()&&(e=o.$re(/^(@[\w-]+)\s*:/)))return e[1]},variableCall:function(e){var r,t,a=o.i,s=!!e,u=e;if(o.save(),u||"@"===o.currentChar()&&(u=o.$re(/^(@[\w-]+)(\(\s*\))?/))){if(!(r=this.mixin.ruleLookups())&&(s&&"()"!==o.$str("()")||"()"!==u[2]))return void o.restore("Missing '[...]' lookup in variable call");s||(u=u[1]),r&&i.important()&&(t=!0);var l=new tree.VariableCall(u,a,n);return!s&&i.end()?(o.forget(),l):(o.forget(),new tree.NamespaceValue(l,r,t,a,n))}o.restore()},extend:function(e){var r,t,i,u,l,c=o.i;if(o.$str(e?"&:extend(":":extend(")){do{for(i=null,r=null;!(i=o.$re(/^(all)(?=\s*(\)|,))/))&&(t=this.element());)r?r.push(t):r=[t];i=i&&i[1],r||a("Missing target selector for :extend()."),l=new tree.Extend(new tree.Selector(r),i,c,n),u?u.push(l):u=[l]}while(o.$char(","));return s(/^\)/),e&&s(/^;/),u}},extendRule:function(){return this.extend(!0)},mixin:{call:function(e,r){var t,a,s,l,c=o.currentChar(),f=!1,h=o.i;if("."===c||"#"===c){if(o.save(),a=this.elements()){if(o.$char("(")&&(s=this.args(!0).args,u(")"),l=!0),!1!==r&&(t=this.ruleLookups()),!0===r&&!t)return void o.restore();if(e&&!t&&!l)return void o.restore();if(!e&&i.important()&&(f=!0),e||i.end()){o.forget();var p=new tree.mixin.Call(a,s,h,n,!t&&f);return t?new tree.NamespaceValue(p,t,f):p}}o.restore()}},elements:function(){for(var e,r,t,i,a,s=/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/;a=o.i,r=o.$re(s);)i=new tree.Element(t,r,!1,a,n),e?e.push(i):e=[i],t=o.$char(">");return e},args:function(e){var r,t,n,s,u,l,c,f=i.entities,h={args:null,variadic:!1},p=[],d=[],m=[],v=!0;for(o.save();;){if(e)l=i.detachedRuleset()||i.expression();else{if(o.commentStore.length=0,o.$str("...")){h.variadic=!0,o.$char(";")&&!r&&(r=!0),(r?d:m).push({variadic:!0});break}l=f.variable()||f.property()||f.literal()||f.keyword()||this.call(!0)}if(!l||!v)break;s=null,l.throwAwayComments&&l.throwAwayComments(),u=l;var g=null;if(e?l.value&&1==l.value.length&&(g=l.value[0]):g=l,g&&(g instanceof tree.Variable||g instanceof tree.Property))if(o.$char(":")){if(p.length>0&&(r&&a("Cannot mix ; and , as delimiter types"),t=!0),!(u=i.detachedRuleset()||i.expression())){if(!e)return o.restore(),h.args=[],h;a("could not understand value for named argument")}s=n=g.name}else if(o.$str("...")){if(!e){h.variadic=!0,o.$char(";")&&!r&&(r=!0),(r?d:m).push({name:l.name,variadic:!0});break}c=!0}else e||(n=s=g.name,u=null);u&&p.push(u),m.push({name:s,value:u,expand:c}),o.$char(",")?v=!0:((v=";"===o.$char(";"))||r)&&(t&&a("Cannot mix ; and , as delimiter types"),r=!0,p.length>1&&(u=new tree.Value(p)),d.push({name:n,value:u,expand:c}),n=null,p=[],t=!1)}return o.forget(),h.args=r?d:m,h},definition:function(){var e,r,t,n,a=[],u=!1;if(!("."!==o.currentChar()&&"#"!==o.currentChar()||o.peek(/^[^{]*\}/)))if(o.save(),r=o.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){e=r[1];var l=this.args(!1);if(a=l.args,u=l.variadic,!o.$char(")"))return void o.restore("Missing closing ')'");if(o.commentStore.length=0,o.$str("when")&&(n=s(i.conditions,"expected condition")),t=i.block())return o.forget(),new tree.mixin.Definition(e,a,t,n,u);o.restore()}else o.forget()},ruleLookups:function(){var e,r=[];if("["===o.currentChar()){for(;;){if(o.save(),null,!(e=this.lookupValue())&&""!==e){o.restore();break}r.push(e),o.forget()}return r.length>0?r:void 0}},lookupValue:function(){if(o.save(),o.$char("[")){var e=o.$re(/^(?:[@$]{0,2})[_a-zA-Z0-9-]*/);if(o.$char("]"))return e||""===e?(o.forget(),e):void o.restore();o.restore()}else o.restore()}},entity:function(){var e=this.entities;return this.comment()||e.literal()||e.variable()||e.url()||e.property()||e.call()||e.keyword()||this.mixin.call(!0)||e.javascript()},end:function(){return o.$char(";")||o.peek("}")},ieAlpha:function(){var e;if(o.$re(/^opacity=/i))return(e=o.$re(/^\d+/))||(e="@{"+(e=s(i.entities.variable,"Could not parse alpha")).name.slice(1)+"}"),u(")"),new tree.Quoted("","alpha(opacity="+e+")")},element:function(){var e,r,t,i=o.i;if(r=this.combinator(),(e=o.$re(/^(?:\d+\.\d+|\d+)%/)||o.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||o.$char("*")||o.$char("&")||this.attribute()||o.$re(/^\([^&()@]+\)/)||o.$re(/^[\.#:](?=@)/)||this.entities.variableCurly())||(o.save(),o.$char("(")?(t=this.selector(!1))&&o.$char(")")?(e=new tree.Paren(t),o.forget()):o.restore("Missing closing ')'"):o.forget()),e)return new tree.Element(r,e,e instanceof tree.Variable,i,n)},combinator:function(){var e=o.currentChar();if("/"===e){o.save();var r=o.$re(/^\/[a-z]+\//i);if(r)return o.forget(),new tree.Combinator(r);o.restore()}if(">"===e||"+"===e||"~"===e||"|"===e||"^"===e){for(o.i++,"^"===e&&"^"===o.currentChar()&&(e="^^",o.i++);o.isWhitespace();)o.i++;return new tree.Combinator(e)}return o.isWhitespace(-1)?new tree.Combinator(" "):new tree.Combinator(null)},selector:function(e){var r,t,i,u,l,c,f,h=o.i;for(e=!1!==e;(e&&(t=this.extend())||e&&(c=o.$str("when"))||(u=this.element()))&&(c?f=s(this.conditions,"expected condition"):f?a("CSS guard can only be used at the end of selector"):t?l=l?l.concat(t):t:(l&&a("Extend can only be used at the end of selector"),i=o.currentChar(),r?r.push(u):r=[u],u=null),"{"!==i&&"}"!==i&&";"!==i&&","!==i&&")"!==i););if(r)return new tree.Selector(r,l,f,h,n);l&&a("Extend must be used to extend a selector, it cannot be used on its own")},selectors:function(){for(var e,r;(e=this.selector())&&(r?r.push(e):r=[e],o.commentStore.length=0,e.condition&&r.length>1&&a("Guards are only currently allowed on a single selector."),o.$char(","));)e.condition&&a("Guards are only currently allowed on a single selector."),o.commentStore.length=0;return r},attribute:function(){if(o.$char("[")){var e,r,t,n=this.entities;return(e=n.variableCurly())||(e=s(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),(t=o.$re(/^[|~*$^]?=/))&&(r=n.quoted()||o.$re(/^[0-9]+%/)||o.$re(/^[\w-]+/)||n.variableCurly()),u("]"),new tree.Attribute(e,t,r)}},block:function(){var e;if(o.$char("{")&&(e=this.primary())&&o.$char("}"))return e},blockRuleset:function(){var e=this.block();return e&&(e=new tree.Ruleset(null,e)),e},detachedRuleset:function(){var e,r,t;if(o.save(),!o.$re(/^[.#]\(/)||(r=(e=this.mixin.args(!1)).args,t=e.variadic,o.$char(")"))){var n=this.blockRuleset();if(n)return o.forget(),r?new tree.mixin.Definition(null,r,n,null,t):new tree.DetachedRuleset(n);o.restore()}else o.restore()},ruleset:function(){var e,t,n;if(o.save(),r.dumpLineNumbers&&(n=l(o.i)),(e=this.selectors())&&(t=this.block())){o.forget();var i=new tree.Ruleset(e,t,r.strictImports);return r.dumpLineNumbers&&(i.debugInfo=n),i}o.restore()},declaration:function(){var e,r,t,i,a,s,u=o.i,l=o.currentChar();if("."!==l&&"#"!==l&&"&"!==l&&":"!==l)if(o.save(),e=this.variable()||this.ruleProperty()){if((s="string"==typeof e)&&(r=this.detachedRuleset())&&(t=!0),o.commentStore.length=0,!r){if(a=!s&&e.length>1&&e.pop().value,r=e[0].value&&"--"===e[0].value.slice(0,2)?this.permissiveValue():this.anonymousValue())return o.forget(),new tree.Declaration(e,r,!1,a,u,n);r||(r=this.value()),r?i=this.important():s&&(r=this.permissiveValue())}if(r&&(this.end()||t))return o.forget(),new tree.Declaration(e,r,i,a,u,n);o.restore()}else o.restore()},anonymousValue:function(){var e=o.i,r=o.$re(/^([^.#@\$+\/'"*`(;{}-]*);/);if(r)return new tree.Anonymous(r[1],e)},permissiveValue:function(e){var r,t,i,s,u=e||";",l=o.i,c=[];function f(){var e=o.currentChar();return"string"==typeof u?e===u:u.test(e)}if(!f()){s=[];do{(t=this.comment())?s.push(t):(t=this.entity())&&s.push(t)}while(t);if(i=f(),s.length>0){if(s=new tree.Expression(s),i)return s;c.push(s)," "===o.prevChar()&&c.push(new tree.Anonymous(" ",l))}if(o.save(),s=o.$parseUntil(u)){if("string"==typeof s&&a("Expected '"+s+"'","Parse"),1===s.length&&" "===s[0])return o.forget(),new tree.Anonymous("",l);var h;for(r=0;r<s.length;r++)if(h=s[r],Array.isArray(h))c.push(new tree.Quoted(h[0],h[1],!0,l,n));else{r===s.length-1&&(h=h.trim());var p=new tree.Quoted("'",h,!0,l,n);p.variableRegex=/@([\w-]+)/g,p.propRegex=/\$([\w-]+)/g,c.push(p)}return o.forget(),new tree.Expression(c,!0)}o.restore()}},import:function(){var e,r,t=o.i,i=o.$re(/^@import?\s+/);if(i){var s=(i?this.importOptions():null)||{};if(e=this.entities.quoted()||this.entities.url())return r=this.mediaFeatures(),o.$char(";")||(o.i=t,a("missing semi-colon or unrecognised media features on import")),r=r&&new tree.Value(r),new tree.Import(e,r,s,t,n);o.i=t,a("malformed import statement")}},importOptions:function(){var e,r,t,n={};if(!o.$char("("))return null;do{if(e=this.importOption()){switch(t=!0,r=e){case"css":r="less",t=!1;break;case"once":r="multiple",t=!1}if(n[r]=t,!o.$char(","))break}}while(e);return u(")"),n},importOption:function(){var e=o.$re(/^(less|css|multiple|once|inline|reference|optional)/);if(e)return e[1]},mediaFeature:function(){var e,r,t=this.entities,i=[];o.save();do{(e=t.keyword()||t.variable()||t.mixinLookup())?i.push(e):o.$char("(")&&(r=this.property(),e=this.value(),o.$char(")")?r&&e?i.push(new tree.Paren(new tree.Declaration(r,e,null,null,o.i,n,!0))):e?i.push(new tree.Paren(e)):a("badly formed media feature definition"):a("Missing closing ')'","Parse"))}while(e);if(o.forget(),i.length>0)return new tree.Expression(i)},mediaFeatures:function(){var e,r=this.entities,t=[];do{if(e=this.mediaFeature()){if(t.push(e),!o.$char(","))break}else if((e=r.variable()||r.mixinLookup())&&(t.push(e),!o.$char(",")))break}while(e);return t.length>0?t:null},media:function(){var e,t,i,s,u=o.i;if(r.dumpLineNumbers&&(s=l(u)),o.save(),o.$str("@media"))return e=this.mediaFeatures(),(t=this.block())||a("media definitions require block statements after any features"),o.forget(),i=new tree.Media(t,e,u,n),r.dumpLineNumbers&&(i.debugInfo=s),i;o.restore()},plugin:function(){var e,r,t,i=o.i;if(o.$re(/^@plugin?\s+/)){if(t=(r=this.pluginArgs())?{pluginArgs:r,isPlugin:!0}:{isPlugin:!0},e=this.entities.quoted()||this.entities.url())return o.$char(";")||(o.i=i,a("missing semi-colon on @plugin")),new tree.Import(e,null,t,i,n);o.i=i,a("malformed @plugin statement")}},pluginArgs:function(){if(o.save(),!o.$char("("))return o.restore(),null;var e=o.$re(/^\s*([^\);]+)\)\s*/);return e[1]?(o.forget(),e[1].trim()):(o.restore(),null)},atrule:function(){var e,t,i,s,u,c,f,h=o.i,p=!0,d=!0;if("@"===o.currentChar()){if(t=this.import()||this.plugin()||this.media())return t;if(o.save(),e=o.$re(/^@[a-z-]+/)){switch(s=e,"-"==e.charAt(1)&&e.indexOf("-",2)>0&&(s="@"+e.slice(e.indexOf("-",2)+1)),s){case"@charset":u=!0,p=!1;break;case"@namespace":c=!0,p=!1;break;case"@keyframes":case"@counter-style":u=!0;break;case"@document":case"@supports":f=!0,d=!1;break;default:f=!0}if(o.commentStore.length=0,u?(t=this.entity())||a("expected "+e+" identifier"):c?(t=this.expression())||a("expected "+e+" expression"):f&&(t=this.permissiveValue(/^[{;]/),p="{"===o.currentChar(),t?t.value||(t=null):p||";"===o.currentChar()||a(e+" rule is missing block or ending semi-colon")),p&&(i=this.blockRuleset()),i||!p&&t&&o.$char(";"))return o.forget(),new tree.AtRule(e,t,i,h,n,r.dumpLineNumbers?l(h):null,d);o.restore("at-rule options not recognised")}}},value:function(){var e,r=[],t=o.i;do{if((e=this.expression())&&(r.push(e),!o.$char(",")))break}while(e);if(r.length>0)return new tree.Value(r,t)},important:function(){if("!"===o.currentChar())return o.$re(/^! *important/)},sub:function(){var e,r;if(o.save(),o.$char("("))return(e=this.addition())&&o.$char(")")?(o.forget(),(r=new tree.Expression([e])).parens=!0,r):void o.restore("Expected ')'");o.restore()},multiplication:function(){var e,r,t,n,i;if(e=this.operand()){for(i=o.isWhitespace(-1);!o.peek(/^\/[*\/]/);){if(o.save(),!(t=o.$char("/")||o.$char("*")||o.$str("./"))){o.forget();break}if(!(r=this.operand())){o.restore();break}o.forget(),e.parensInOp=!0,r.parensInOp=!0,n=new tree.Operation(t,[n||e,r],i),i=o.isWhitespace(-1)}return n||e}},addition:function(){var e,r,t,n,i;if(e=this.multiplication()){for(i=o.isWhitespace(-1);(t=o.$re(/^[-+]\s+/)||!i&&(o.$char("+")||o.$char("-")))&&(r=this.multiplication());)e.parensInOp=!0,r.parensInOp=!0,n=new tree.Operation(t,[n||e,r],i),i=o.isWhitespace(-1);return n||e}},conditions:function(){var e,r,t,n=o.i;if(e=this.condition(!0)){for(;o.peek(/^,\s*(not\s*)?\(/)&&o.$char(",")&&(r=this.condition(!0));)t=new tree.Condition("or",t||e,r,n);return t||e}},condition:function(e){var r,t,n;if(r=this.conditionAnd(e)){if(t=o.$str("or")){if(!(n=this.condition(e)))return;r=new tree.Condition(t,r,n)}return r}},conditionAnd:function(e){var r,t,n,i,a=this;if(r=(i=a.negatedCondition(e)||a.parenthesisCondition(e))||e?i:a.atomicCondition(e)){if(t=o.$str("and")){if(!(n=this.conditionAnd(e)))return;r=new tree.Condition(t,r,n)}return r}},negatedCondition:function(e){if(o.$str("not")){var r=this.parenthesisCondition(e);return r&&(r.negate=!r.negate),r}},parenthesisCondition:function(e){var r;if(o.save(),o.$str("(")){if(r=function(r){var t;if(o.save(),t=r.condition(e)){if(o.$char(")"))return o.forget(),t;o.restore()}else o.restore()}(this))return o.forget(),r;if(r=this.atomicCondition(e)){if(o.$char(")"))return o.forget(),r;o.restore("expected ')' got '"+o.currentChar()+"'")}else o.restore()}else o.restore()},atomicCondition:function(e){var r,t,n,i,s=this.entities,u=o.i;function l(){return this.addition()||s.keyword()||s.quoted()||s.mixinLookup()}if(r=(l=l.bind(this))())return o.$char(">")?i=o.$char("=")?">=":">":o.$char("<")?i=o.$char("=")?"<=":"<":o.$char("=")&&(i=o.$char(">")?"=>":o.$char("<")?"=<":"="),i?(t=l())?n=new tree.Condition(i,r,t,u,!1):a("expected expression"):n=new tree.Condition("=",r,new tree.Keyword("true"),u,!1),n},operand:function(){var e,r=this.entities;o.peek(/^-[@\$\(]/)&&(e=o.$char("-"));var t=this.sub()||r.dimension()||r.color()||r.variable()||r.property()||r.call()||r.quoted(!0)||r.colorKeyword()||r.mixinLookup();return e&&(t.parensInOp=!0,t=new tree.Negative(t)),t},expression:function(){var e,r,t=[],n=o.i;do{(e=this.comment())?t.push(e):(e=this.addition()||this.entity())&&(t.push(e),o.peek(/^\/[\/*]/)||(r=o.$char("/"))&&t.push(new tree.Anonymous(r,n)))}while(e);if(t.length>0)return new tree.Expression(t)},property:function(){var e=o.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);if(e)return e[1]},ruleProperty:function(){var e,r,t=[],i=[];o.save();var a=o.$re(/^([_a-zA-Z0-9-]+)\s*:/);if(a)return t=[new tree.Keyword(a[1])],o.forget(),t;function s(e){var r=o.i,n=o.$re(e);if(n)return i.push(r),t.push(n[1])}for(s(/^(\*?)/);s(/^((?:[\w-]+)|(?:[@\$]\{[\w-]+\}))/););if(t.length>1&&s(/^((?:\+_|\+)?)\s*:/)){for(o.forget(),""===t[0]&&(t.shift(),i.shift()),r=0;r<t.length;r++)e=t[r],t[r]="@"!==e.charAt(0)&&"$"!==e.charAt(0)?new tree.Keyword(e):"@"===e.charAt(0)?new tree.Variable("@"+e.slice(2,-1),i[r],n):new tree.Property("$"+e.slice(2,-1),i[r],n);return t}o.restore()}}}};Parser.serializeVars=function(e){var r="";for(var t in e)if(Object.hasOwnProperty.call(e,t)){var n=e[t];r+=("@"===t[0]?"":"@")+t+": "+n+(";"===String(n).slice(-1)?"":";")}return r},module.exports=Parser;
//# sourceMappingURL=../../sourcemaps/engine/parser/parser.js.map
