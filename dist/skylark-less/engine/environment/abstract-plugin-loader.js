/**
 * skylark-less - A version of less.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-less/
 * @license MIT
 */
define(["../functions/function-registry","../less-error"],function(e,t){"use strict";var n={},r={exports:{}},i=e,s=t,o=function(){this.require=function(){return null}};function u(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return o.prototype.evalPlugin=function(e,t,n,r,o){var u,a,p,l,f,c;l=t.pluginManager,o&&(f="string"==typeof o?o:o.filename);var g=(new this.less.FileManager).extractUrlParts(f).filename;if(f&&(a=l.get(f))){if(c=this.trySetOptions(a,f,g,r))return c;try{a.use&&a.use.call(this.context,a)}catch(e){return e.message=e.message||"Error during @plugin call",new s(e,n,f)}return a}p={exports:{},pluginManager:l,fileInfo:o},u=i.create();try{new Function("module","require","registerPlugin","functions","tree","less","fileInfo",e)(p,this.require(f),function(e){a=e},u,this.less.tree,this.less,o)}catch(e){return new s(e,n,f)}if(a||(a=p.exports),(a=this.validatePlugin(a,f,g))instanceof s)return a;if(!a)return new s({message:"Not a valid plugin"},n,f);if(a.imports=n,a.filename=f,(!a.minVersion||this.compareVersion("3.0.0",a.minVersion)<0)&&(c=this.trySetOptions(a,f,g,r)))return c;if(l.addPlugin(a,o.filename,u),a.functions=u.getLocalFunctions(),c=this.trySetOptions(a,f,g,r))return c;try{a.use&&a.use.call(this.context,a)}catch(e){return e.message=e.message||"Error during @plugin call",new s(e,n,f)}return a},o.prototype.trySetOptions=function(e,t,n,r){if(r&&!e.setOptions)return new s({message:"Options have been provided but the plugin "+n+" does not support any options."});try{e.setOptions&&e.setOptions(r)}catch(e){return new s(e)}},o.prototype.validatePlugin=function(e,t,n){return e?("function"==typeof e&&(e=new e),e.minVersion&&this.compareVersion(e.minVersion,this.less.version)<0?new s({message:"Plugin "+n+" requires version "+this.versionToString(e.minVersion)}):e):null},o.prototype.compareVersion=function(e,t){"string"==typeof e&&(e=e.match(/^(\d+)\.?(\d+)?\.?(\d+)?/)).shift();for(var n=0;n<e.length;n++)if(e[n]!==t[n])return parseInt(e[n])>parseInt(t[n])?-1:1;return 0},o.prototype.versionToString=function(e){for(var t="",n=0;n<e.length;n++)t+=(t?".":"")+e[n];return t},o.prototype.printUsage=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.printUsage&&n.printUsage()}},r.exports=o,u(r.exports)?r.exports:u(n)?n:void 0});
//# sourceMappingURL=../../sourcemaps/engine/environment/abstract-plugin-loader.js.map
