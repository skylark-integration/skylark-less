{"version":3,"sources":["browser/index.js"],"names":["define","__module__0","__module__1","__module__2","__module__3","__module__4","__module__5","__module__6","__module__7","__module__8","exports","module","addDataAttr","browser","__isValidToReturn","obj","Array","isArray","attr","__isEmptyObject","window","options","document","less","environment","FileManager","logger","fileManager","addFileManager","PluginLoader","errors","cache","functions","functionRegistry","addMultiple","typePattern","clone","cloned","prop","hasOwnProperty","bind","func","thisArg","curryArgs","prototype","slice","call","arguments","args","concat","apply","loadStyles","modifyVars","style","styles","getElementsByTagName","i","length","type","match","instanceOptions","lessText","innerHTML","filename","location","href","replace","render","e","result","add","styleSheet","cssText","css","loadStyleSheet","sheet","callback","reload","remaining","mime","loadFile","then","loadedFile","data","contents","path","webInfo","newFileInfo","currentDirectory","getPath","rootFilename","rewriteUrls","entryPath","rootpath","getCSS","local","remove","rootFileInfo","setCSS","lastModified","loadInitialFileCallback","catch","err","console","log","loadStyleSheets","sheets","watch","watchMode","env","watchTimer","setInterval","clearFileCache","_","createCSS","poll","this","unwatch","clearInterval","registerStylesheetsImmediately","links","rel","push","registerStylesheets","Promise","resolve","reject","record","refresh","startTime","endTime","totalMilliseconds","remainingSheets","Date","info","refreshStyles"],"mappings":"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","file":"../../browser/index.js","sourcesContent":["define([\n    './utils',\n    './browser',\n    '../less',\n    './file-manager',\n    './plugin-loader',\n    './log-listener',\n    './error-reporting',\n    './cache',\n    './image-size'\n], function (__module__0, __module__1, __module__2, __module__3, __module__4, __module__5, __module__6, __module__7, __module__8) {\n    'use strict';\n    var exports = {};\n    var module = { exports: {} };\n    var addDataAttr = __module__0.addDataAttr, browser = __module__1;\n    module.exports = function (window, options) {\n        var document = window.document;\n        var less = __module__2();\n        less.options = options;\n        var environment = less.environment, FileManager = __module__3(options, less.logger), fileManager = new FileManager();\n        environment.addFileManager(fileManager);\n        less.FileManager = FileManager;\n        less.PluginLoader = __module__4;\n        __module__5(less, options);\n        var errors = __module__6(window, less, options);\n        var cache = less.cache = options.cache || __module__7(window, options, less.logger);\n        __module__8(less.environment);\n        if (options.functions) {\n            less.functions.functionRegistry.addMultiple(options.functions);\n        }\n        var typePattern = /^text\\/(x-)?less$/;\n        function clone(obj) {\n            var cloned = {};\n            for (var prop in obj) {\n                if (obj.hasOwnProperty(prop)) {\n                    cloned[prop] = obj[prop];\n                }\n            }\n            return cloned;\n        }\n        function bind(func, thisArg) {\n            var curryArgs = Array.prototype.slice.call(arguments, 2);\n            return function () {\n                var args = curryArgs.concat(Array.prototype.slice.call(arguments, 0));\n                return func.apply(thisArg, args);\n            };\n        }\n        function loadStyles(modifyVars) {\n            var styles = document.getElementsByTagName('style'), style;\n            for (var i = 0; i < styles.length; i++) {\n                style = styles[i];\n                if (style.type.match(typePattern)) {\n                    var instanceOptions = clone(options);\n                    instanceOptions.modifyVars = modifyVars;\n                    var lessText = style.innerHTML || '';\n                    instanceOptions.filename = document.location.href.replace(/#.*$/, '');\n                    less.render(lessText, instanceOptions, bind(function (style, e, result) {\n                        if (e) {\n                            errors.add(e, 'inline');\n                        } else {\n                            style.type = 'text/css';\n                            if (style.styleSheet) {\n                                style.styleSheet.cssText = result.css;\n                            } else {\n                                style.innerHTML = result.css;\n                            }\n                        }\n                    }, null, style));\n                }\n            }\n        }\n        function loadStyleSheet(sheet, callback, reload, remaining, modifyVars) {\n            var instanceOptions = clone(options);\n            addDataAttr(instanceOptions, sheet);\n            instanceOptions.mime = sheet.type;\n            if (modifyVars) {\n                instanceOptions.modifyVars = modifyVars;\n            }\n            function loadInitialFileCallback(loadedFile) {\n                var data = loadedFile.contents, path = loadedFile.filename, webInfo = loadedFile.webInfo;\n                var newFileInfo = {\n                    currentDirectory: fileManager.getPath(path),\n                    filename: path,\n                    rootFilename: path,\n                    rewriteUrls: instanceOptions.rewriteUrls\n                };\n                newFileInfo.entryPath = newFileInfo.currentDirectory;\n                newFileInfo.rootpath = instanceOptions.rootpath || newFileInfo.currentDirectory;\n                if (webInfo) {\n                    webInfo.remaining = remaining;\n                    var css = cache.getCSS(path, webInfo, instanceOptions.modifyVars);\n                    if (!reload && css) {\n                        webInfo.local = true;\n                        callback(null, css, data, sheet, webInfo, path);\n                        return;\n                    }\n                }\n                errors.remove(path);\n                instanceOptions.rootFileInfo = newFileInfo;\n                less.render(data, instanceOptions, function (e, result) {\n                    if (e) {\n                        e.href = path;\n                        callback(e);\n                    } else {\n                        cache.setCSS(sheet.href, webInfo.lastModified, instanceOptions.modifyVars, result.css);\n                        callback(null, result.css, data, sheet, webInfo, path);\n                    }\n                });\n            }\n            fileManager.loadFile(sheet.href, null, instanceOptions, environment).then(function (loadedFile) {\n                loadInitialFileCallback(loadedFile);\n            }).catch(function (err) {\n                console.log(err);\n                callback(err);\n            });\n        }\n        function loadStyleSheets(callback, reload, modifyVars) {\n            for (var i = 0; i < less.sheets.length; i++) {\n                loadStyleSheet(less.sheets[i], callback, reload, less.sheets.length - (i + 1), modifyVars);\n            }\n        }\n        function initRunningMode() {\n            if (less.env === 'development') {\n                less.watchTimer = setInterval(function () {\n                    if (less.watchMode) {\n                        fileManager.clearFileCache();\n                        loadStyleSheets(function (e, css, _, sheet, webInfo) {\n                            if (e) {\n                                errors.add(e, e.href || sheet.href);\n                            } else if (css) {\n                                browser.createCSS(window.document, css, sheet);\n                            }\n                        });\n                    }\n                }, options.poll);\n            }\n        }\n        less.watch = function () {\n            if (!less.watchMode) {\n                less.env = 'development';\n                initRunningMode();\n            }\n            this.watchMode = true;\n            return true;\n        };\n        less.unwatch = function () {\n            clearInterval(less.watchTimer);\n            this.watchMode = false;\n            return false;\n        };\n        less.registerStylesheetsImmediately = function () {\n            var links = document.getElementsByTagName('link');\n            less.sheets = [];\n            for (var i = 0; i < links.length; i++) {\n                if (links[i].rel === 'stylesheet/less' || links[i].rel.match(/stylesheet/) && links[i].type.match(typePattern)) {\n                    less.sheets.push(links[i]);\n                }\n            }\n        };\n        less.registerStylesheets = function () {\n            return new Promise(function (resolve, reject) {\n                less.registerStylesheetsImmediately();\n                resolve();\n            });\n        };\n        less.modifyVars = function (record) {\n            return less.refresh(true, record, false);\n        };\n        less.refresh = function (reload, modifyVars, clearFileCache) {\n            if ((reload || clearFileCache) && clearFileCache !== false) {\n                fileManager.clearFileCache();\n            }\n            return new Promise(function (resolve, reject) {\n                var startTime, endTime, totalMilliseconds, remainingSheets;\n                startTime = endTime = new Date();\n                remainingSheets = less.sheets.length;\n                if (remainingSheets === 0) {\n                    endTime = new Date();\n                    totalMilliseconds = endTime - startTime;\n                    less.logger.info('Less has finished and no sheets were loaded.');\n                    resolve({\n                        startTime: startTime,\n                        endTime: endTime,\n                        totalMilliseconds: totalMilliseconds,\n                        sheets: less.sheets.length\n                    });\n                } else {\n                    loadStyleSheets(function (e, css, _, sheet, webInfo) {\n                        if (e) {\n                            errors.add(e, e.href || sheet.href);\n                            reject(e);\n                            return;\n                        }\n                        if (webInfo.local) {\n                            less.logger.info('Loading ' + sheet.href + ' from cache.');\n                        } else {\n                            less.logger.info('Rendered ' + sheet.href + ' successfully.');\n                        }\n                        browser.createCSS(window.document, css, sheet);\n                        less.logger.info('CSS for ' + sheet.href + ' generated in ' + (new Date() - endTime) + 'ms');\n                        remainingSheets--;\n                        if (remainingSheets === 0) {\n                            totalMilliseconds = new Date() - startTime;\n                            less.logger.info('Less has finished. CSS generated in ' + totalMilliseconds + 'ms');\n                            resolve({\n                                startTime: startTime,\n                                endTime: endTime,\n                                totalMilliseconds: totalMilliseconds,\n                                sheets: less.sheets.length\n                            });\n                        }\n                        endTime = new Date();\n                    }, reload, modifyVars);\n                }\n                loadStyles(modifyVars);\n            });\n        };\n        less.refreshStyles = loadStyles;\n        return less;\n    };\n    function __isEmptyObject(obj) {\n        var attr;\n        for (attr in obj)\n            return !1;\n        return !0;\n    }\n    function __isValidToReturn(obj) {\n        return typeof obj != 'object' || Array.isArray(obj) || !__isEmptyObject(obj);\n    }\n    if (__isValidToReturn(module.exports))\n        return module.exports;\n    else if (__isValidToReturn(exports))\n        return exports;\n});"]}