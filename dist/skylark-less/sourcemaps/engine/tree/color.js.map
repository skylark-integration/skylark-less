{"version":3,"sources":["engine/tree/color.js"],"names":["define","__module__0","__module__1","exports","module","colors","Color","rgb","a","originalForm","self","this","Array","isArray","length","match","map","c","i","push","parseInt","alpha","split","value","clamp","v","max","Math","min","toHex","round","toString","join","__isValidToReturn","obj","attr","__isEmptyObject","prototype","type","luma","r","g","b","pow","genCSS","context","output","add","toCSS","doNotCompress","color","colorFunction","compress","args","fround","indexOf","concat","toHSL","h","s","l","toRGB","splitcolor","operate","op","other","_operate","d","toHSV","toARGB","compare","x","undefined","fromKeyword","keyword","key","toLowerCase","hasOwnProperty","slice"],"mappings":"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","file":"../../../engine/tree/color.js","sourcesContent":["define([\n    './node',\n    '../data/colors'\n], function (__module__0, __module__1) {\n    'use strict';\n    var exports = {};\n    var module = { exports: {} };\n    var Node = __module__0, colors = __module__1;\n    var Color = function (rgb, a, originalForm) {\n        var self = this;\n        if (Array.isArray(rgb)) {\n            this.rgb = rgb;\n        } else if (rgb.length >= 6) {\n            this.rgb = [];\n            rgb.match(/.{2}/g).map(function (c, i) {\n                if (i < 3) {\n                    self.rgb.push(parseInt(c, 16));\n                } else {\n                    self.alpha = parseInt(c, 16) / 255;\n                }\n            });\n        } else {\n            this.rgb = [];\n            rgb.split('').map(function (c, i) {\n                if (i < 3) {\n                    self.rgb.push(parseInt(c + c, 16));\n                } else {\n                    self.alpha = parseInt(c + c, 16) / 255;\n                }\n            });\n        }\n        this.alpha = this.alpha || (typeof a === 'number' ? a : 1);\n        if (typeof originalForm !== 'undefined') {\n            this.value = originalForm;\n        }\n    };\n    Color.prototype = new Node();\n    Color.prototype.type = 'Color';\n    function clamp(v, max) {\n        return Math.min(Math.max(v, 0), max);\n    }\n    function toHex(v) {\n        return '#' + v.map(function (c) {\n            c = clamp(Math.round(c), 255);\n            return (c < 16 ? '0' : '') + c.toString(16);\n        }).join('');\n    }\n    Color.prototype.luma = function () {\n        var r = this.rgb[0] / 255, g = this.rgb[1] / 255, b = this.rgb[2] / 255;\n        r = r <= 0.03928 ? r / 12.92 : Math.pow((r + 0.055) / 1.055, 2.4);\n        g = g <= 0.03928 ? g / 12.92 : Math.pow((g + 0.055) / 1.055, 2.4);\n        b = b <= 0.03928 ? b / 12.92 : Math.pow((b + 0.055) / 1.055, 2.4);\n        return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n    };\n    Color.prototype.genCSS = function (context, output) {\n        output.add(this.toCSS(context));\n    };\n    Color.prototype.toCSS = function (context, doNotCompress) {\n        var compress = context && context.compress && !doNotCompress, color, alpha, colorFunction, args = [];\n        alpha = this.fround(context, this.alpha);\n        if (this.value) {\n            if (this.value.indexOf('rgb') === 0) {\n                if (alpha < 1) {\n                    colorFunction = 'rgba';\n                }\n            } else if (this.value.indexOf('hsl') === 0) {\n                if (alpha < 1) {\n                    colorFunction = 'hsla';\n                } else {\n                    colorFunction = 'hsl';\n                }\n            } else {\n                return this.value;\n            }\n        } else {\n            if (alpha < 1) {\n                colorFunction = 'rgba';\n            }\n        }\n        switch (colorFunction) {\n        case 'rgba':\n            args = this.rgb.map(function (c) {\n                return clamp(Math.round(c), 255);\n            }).concat(clamp(alpha, 1));\n            break;\n        case 'hsla':\n            args.push(clamp(alpha, 1));\n        case 'hsl':\n            color = this.toHSL();\n            args = [\n                this.fround(context, color.h),\n                this.fround(context, color.s * 100) + '%',\n                this.fround(context, color.l * 100) + '%'\n            ].concat(args);\n        }\n        if (colorFunction) {\n            return colorFunction + '(' + args.join(',' + (compress ? '' : ' ')) + ')';\n        }\n        color = this.toRGB();\n        if (compress) {\n            var splitcolor = color.split('');\n            if (splitcolor[1] === splitcolor[2] && splitcolor[3] === splitcolor[4] && splitcolor[5] === splitcolor[6]) {\n                color = '#' + splitcolor[1] + splitcolor[3] + splitcolor[5];\n            }\n        }\n        return color;\n    };\n    Color.prototype.operate = function (context, op, other) {\n        var rgb = new Array(3);\n        var alpha = this.alpha * (1 - other.alpha) + other.alpha;\n        for (var c = 0; c < 3; c++) {\n            rgb[c] = this._operate(context, op, this.rgb[c], other.rgb[c]);\n        }\n        return new Color(rgb, alpha);\n    };\n    Color.prototype.toRGB = function () {\n        return toHex(this.rgb);\n    };\n    Color.prototype.toHSL = function () {\n        var r = this.rgb[0] / 255, g = this.rgb[1] / 255, b = this.rgb[2] / 255, a = this.alpha;\n        var max = Math.max(r, g, b), min = Math.min(r, g, b);\n        var h, s, l = (max + min) / 2, d = max - min;\n        if (max === min) {\n            h = s = 0;\n        } else {\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n            switch (max) {\n            case r:\n                h = (g - b) / d + (g < b ? 6 : 0);\n                break;\n            case g:\n                h = (b - r) / d + 2;\n                break;\n            case b:\n                h = (r - g) / d + 4;\n                break;\n            }\n            h /= 6;\n        }\n        return {\n            h: h * 360,\n            s: s,\n            l: l,\n            a: a\n        };\n    };\n    Color.prototype.toHSV = function () {\n        var r = this.rgb[0] / 255, g = this.rgb[1] / 255, b = this.rgb[2] / 255, a = this.alpha;\n        var max = Math.max(r, g, b), min = Math.min(r, g, b);\n        var h, s, v = max;\n        var d = max - min;\n        if (max === 0) {\n            s = 0;\n        } else {\n            s = d / max;\n        }\n        if (max === min) {\n            h = 0;\n        } else {\n            switch (max) {\n            case r:\n                h = (g - b) / d + (g < b ? 6 : 0);\n                break;\n            case g:\n                h = (b - r) / d + 2;\n                break;\n            case b:\n                h = (r - g) / d + 4;\n                break;\n            }\n            h /= 6;\n        }\n        return {\n            h: h * 360,\n            s: s,\n            v: v,\n            a: a\n        };\n    };\n    Color.prototype.toARGB = function () {\n        return toHex([this.alpha * 255].concat(this.rgb));\n    };\n    Color.prototype.compare = function (x) {\n        return x.rgb && x.rgb[0] === this.rgb[0] && x.rgb[1] === this.rgb[1] && x.rgb[2] === this.rgb[2] && x.alpha === this.alpha ? 0 : undefined;\n    };\n    Color.fromKeyword = function (keyword) {\n        var c, key = keyword.toLowerCase();\n        if (colors.hasOwnProperty(key)) {\n            c = new Color(colors[key].slice(1));\n        } else if (key === 'transparent') {\n            c = new Color([\n                0,\n                0,\n                0\n            ], 0);\n        }\n        if (c) {\n            c.value = keyword;\n            return c;\n        }\n    };\n    module.exports = Color;\n    function __isEmptyObject(obj) {\n        var attr;\n        for (attr in obj)\n            return !1;\n        return !0;\n    }\n    function __isValidToReturn(obj) {\n        return typeof obj != 'object' || Array.isArray(obj) || !__isEmptyObject(obj);\n    }\n    if (__isValidToReturn(module.exports))\n        return module.exports;\n    else if (__isValidToReturn(exports))\n        return exports;\n});"]}