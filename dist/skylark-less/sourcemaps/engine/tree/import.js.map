{"version":3,"sources":["engine/tree/import.js"],"names":["define","__module__0","__module__1","__module__2","__module__3","__module__4","__module__5","__module__6","__module__7","exports","module","Media","URL","Quoted","Ruleset","Anonymous","utils","LessError","Import","path","features","options","index","currentFileInfo","visibilityInfo","this","_index","_fileInfo","allowRoot","undefined","less","inline","css","pathValue","getPath","test","copyVisibilityInfo","setParent","__isValidToReturn","obj","Array","isArray","attr","__isEmptyObject","prototype","type","accept","visitor","visit","isPlugin","root","genCSS","context","output","reference","add","value","isVariableImport","containsVariables","evalForImport","eval","evalPath","fileInfo","pathRequiresRewrite","rewritePath","rootpath","normalizePath","result","doEval","blocksVisibility","length","forEach","node","addVisibilityBlock","ruleset","registry","e","message","imports","filename","frames","functionRegistry","functions","addMultiple","skip","contents","importedFilename","newImport","error","copyArray","rules","evalImports"],"mappings":"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","file":"../../../engine/tree/import.js","sourcesContent":["define([\n    './node',\n    './media',\n    './url',\n    './quoted',\n    './ruleset',\n    './anonymous',\n    '../utils',\n    '../less-error'\n], function (__module__0, __module__1, __module__2, __module__3, __module__4, __module__5, __module__6, __module__7) {\n    'use strict';\n    var exports = {};\n    var module = { exports: {} };\n    var Node = __module__0, Media = __module__1, URL = __module__2, Quoted = __module__3, Ruleset = __module__4, Anonymous = __module__5, utils = __module__6, LessError = __module__7;\n    var Import = function (path, features, options, index, currentFileInfo, visibilityInfo) {\n        this.options = options;\n        this._index = index;\n        this._fileInfo = currentFileInfo;\n        this.path = path;\n        this.features = features;\n        this.allowRoot = true;\n        if (this.options.less !== undefined || this.options.inline) {\n            this.css = !this.options.less || this.options.inline;\n        } else {\n            var pathValue = this.getPath();\n            if (pathValue && /[#\\.\\&\\?]css([\\?;].*)?$/.test(pathValue)) {\n                this.css = true;\n            }\n        }\n        this.copyVisibilityInfo(visibilityInfo);\n        this.setParent(this.features, this);\n        this.setParent(this.path, this);\n    };\n    Import.prototype = new Node();\n    Import.prototype.type = 'Import';\n    Import.prototype.accept = function (visitor) {\n        if (this.features) {\n            this.features = visitor.visit(this.features);\n        }\n        this.path = visitor.visit(this.path);\n        if (!this.options.isPlugin && !this.options.inline && this.root) {\n            this.root = visitor.visit(this.root);\n        }\n    };\n    Import.prototype.genCSS = function (context, output) {\n        if (this.css && this.path._fileInfo.reference === undefined) {\n            output.add('@import ', this._fileInfo, this._index);\n            this.path.genCSS(context, output);\n            if (this.features) {\n                output.add(' ');\n                this.features.genCSS(context, output);\n            }\n            output.add(';');\n        }\n    };\n    Import.prototype.getPath = function () {\n        return this.path instanceof URL ? this.path.value.value : this.path.value;\n    };\n    Import.prototype.isVariableImport = function () {\n        var path = this.path;\n        if (path instanceof URL) {\n            path = path.value;\n        }\n        if (path instanceof Quoted) {\n            return path.containsVariables();\n        }\n        return true;\n    };\n    Import.prototype.evalForImport = function (context) {\n        var path = this.path;\n        if (path instanceof URL) {\n            path = path.value;\n        }\n        return new Import(path.eval(context), this.features, this.options, this._index, this._fileInfo, this.visibilityInfo());\n    };\n    Import.prototype.evalPath = function (context) {\n        var path = this.path.eval(context);\n        var fileInfo = this._fileInfo;\n        if (!(path instanceof URL)) {\n            var pathValue = path.value;\n            if (fileInfo && pathValue && context.pathRequiresRewrite(pathValue)) {\n                path.value = context.rewritePath(pathValue, fileInfo.rootpath);\n            } else {\n                path.value = context.normalizePath(path.value);\n            }\n        }\n        return path;\n    };\n    Import.prototype.eval = function (context) {\n        var result = this.doEval(context);\n        if (this.options.reference || this.blocksVisibility()) {\n            if (result.length || result.length === 0) {\n                result.forEach(function (node) {\n                    node.addVisibilityBlock();\n                });\n            } else {\n                result.addVisibilityBlock();\n            }\n        }\n        return result;\n    };\n    Import.prototype.doEval = function (context) {\n        var ruleset, registry, features = this.features && this.features.eval(context);\n        if (this.options.isPlugin) {\n            if (this.root && this.root.eval) {\n                try {\n                    this.root.eval(context);\n                } catch (e) {\n                    e.message = 'Plugin error during evaluation';\n                    throw new LessError(e, this.root.imports, this.root.filename);\n                }\n            }\n            registry = context.frames[0] && context.frames[0].functionRegistry;\n            if (registry && this.root && this.root.functions) {\n                registry.addMultiple(this.root.functions);\n            }\n            return [];\n        }\n        if (this.skip) {\n            if (typeof this.skip === 'function') {\n                this.skip = this.skip();\n            }\n            if (this.skip) {\n                return [];\n            }\n        }\n        if (this.options.inline) {\n            var contents = new Anonymous(this.root, 0, {\n                filename: this.importedFilename,\n                reference: this.path._fileInfo && this.path._fileInfo.reference\n            }, true, true);\n            return this.features ? new Media([contents], this.features.value) : [contents];\n        } else if (this.css) {\n            var newImport = new Import(this.evalPath(context), features, this.options, this._index);\n            if (!newImport.css && this.error) {\n                throw this.error;\n            }\n            return newImport;\n        } else {\n            ruleset = new Ruleset(null, utils.copyArray(this.root.rules));\n            ruleset.evalImports(context);\n            return this.features ? new Media(ruleset.rules, this.features.value) : ruleset.rules;\n        }\n    };\n    module.exports = Import;\n    function __isEmptyObject(obj) {\n        var attr;\n        for (attr in obj)\n            return !1;\n        return !0;\n    }\n    function __isValidToReturn(obj) {\n        return typeof obj != 'object' || Array.isArray(obj) || !__isEmptyObject(obj);\n    }\n    if (__isValidToReturn(module.exports))\n        return module.exports;\n    else if (__isValidToReturn(exports))\n        return exports;\n});"]}