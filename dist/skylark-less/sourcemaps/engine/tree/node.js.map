{"version":3,"sources":["engine/tree/node.js"],"names":["Node","this","parent","visibilityBlocks","undefined","nodeVisible","rootNode","parsed","self","Object","defineProperty","get","fileInfo","getIndex","prototype","setParent","nodes","set","node","Array","isArray","forEach","_index","_fileInfo","isRulesetLike","toCSS","context","strs","genCSS","add","chunk","index","push","isEmpty","length","join","output","value","accept","visitor","visit","eval","_operate","op","a","b","fround","precision","numPrecision","Number","toFixed","compare","type","i","numericCompare","blocksVisibility","addVisibilityBlock","removeVisibilityBlock","ensureVisibility","ensureInvisibility","isVisible","visibilityInfo","copyVisibilityInfo","info","module","exports"],"mappings":"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","file":"../../../engine/tree/node.js","sourcesContent":["var Node = function () {\n    this.parent = null;\n    this.visibilityBlocks = undefined;\n    this.nodeVisible = undefined;\n    this.rootNode = null;\n    this.parsed = null;\n    var self = this;\n    Object.defineProperty(this, 'currentFileInfo', {\n        get: function () {\n            return self.fileInfo();\n        }\n    });\n    Object.defineProperty(this, 'index', {\n        get: function () {\n            return self.getIndex();\n        }\n    });\n};\nNode.prototype.setParent = function (nodes, parent) {\n    function set(node) {\n        if (node && node instanceof Node) {\n            node.parent = parent;\n        }\n    }\n    if (Array.isArray(nodes)) {\n        nodes.forEach(set);\n    } else {\n        set(nodes);\n    }\n};\nNode.prototype.getIndex = function () {\n    return this._index || this.parent && this.parent.getIndex() || 0;\n};\nNode.prototype.fileInfo = function () {\n    return this._fileInfo || this.parent && this.parent.fileInfo() || {};\n};\nNode.prototype.isRulesetLike = function () {\n    return false;\n};\nNode.prototype.toCSS = function (context) {\n    var strs = [];\n    this.genCSS(context, {\n        add: function (chunk, fileInfo, index) {\n            strs.push(chunk);\n        },\n        isEmpty: function () {\n            return strs.length === 0;\n        }\n    });\n    return strs.join('');\n};\nNode.prototype.genCSS = function (context, output) {\n    output.add(this.value);\n};\nNode.prototype.accept = function (visitor) {\n    this.value = visitor.visit(this.value);\n};\nNode.prototype.eval = function () {\n    return this;\n};\nNode.prototype._operate = function (context, op, a, b) {\n    switch (op) {\n    case '+':\n        return a + b;\n    case '-':\n        return a - b;\n    case '*':\n        return a * b;\n    case '/':\n        return a / b;\n    }\n};\nNode.prototype.fround = function (context, value) {\n    var precision = context && context.numPrecision;\n    return precision ? Number((value + 2e-16).toFixed(precision)) : value;\n};\nNode.compare = function (a, b) {\n    if (a.compare && !(b.type === 'Quoted' || b.type === 'Anonymous')) {\n        return a.compare(b);\n    } else if (b.compare) {\n        return -b.compare(a);\n    } else if (a.type !== b.type) {\n        return undefined;\n    }\n    a = a.value;\n    b = b.value;\n    if (!Array.isArray(a)) {\n        return a === b ? 0 : undefined;\n    }\n    if (a.length !== b.length) {\n        return undefined;\n    }\n    for (var i = 0; i < a.length; i++) {\n        if (Node.compare(a[i], b[i]) !== 0) {\n            return undefined;\n        }\n    }\n    return 0;\n};\nNode.numericCompare = function (a, b) {\n    return a < b ? -1 : a === b ? 0 : a > b ? 1 : undefined;\n};\nNode.prototype.blocksVisibility = function () {\n    if (this.visibilityBlocks == null) {\n        this.visibilityBlocks = 0;\n    }\n    return this.visibilityBlocks !== 0;\n};\nNode.prototype.addVisibilityBlock = function () {\n    if (this.visibilityBlocks == null) {\n        this.visibilityBlocks = 0;\n    }\n    this.visibilityBlocks = this.visibilityBlocks + 1;\n};\nNode.prototype.removeVisibilityBlock = function () {\n    if (this.visibilityBlocks == null) {\n        this.visibilityBlocks = 0;\n    }\n    this.visibilityBlocks = this.visibilityBlocks - 1;\n};\nNode.prototype.ensureVisibility = function () {\n    this.nodeVisible = true;\n};\nNode.prototype.ensureInvisibility = function () {\n    this.nodeVisible = false;\n};\nNode.prototype.isVisible = function () {\n    return this.nodeVisible;\n};\nNode.prototype.visibilityInfo = function () {\n    return {\n        visibilityBlocks: this.visibilityBlocks,\n        nodeVisible: this.nodeVisible\n    };\n};\nNode.prototype.copyVisibilityInfo = function (info) {\n    if (!info) {\n        return;\n    }\n    this.visibilityBlocks = info.visibilityBlocks;\n    this.nodeVisible = info.nodeVisible;\n};\nmodule.exports = Node;"]}