{"version":3,"sources":["engine/tree/media.js"],"names":["define","__module__0","__module__1","__module__2","__module__3","__module__4","__module__5","__module__6","exports","module","Ruleset","Value","Selector","Anonymous","Expression","utils","Media","value","features","index","currentFileInfo","visibilityInfo","this","_index","_fileInfo","selectors","createEmptySelectors","rules","allowImports","copyVisibilityInfo","allowRoot","setParent","__isValidToReturn","obj","Array","isArray","attr","__isEmptyObject","prototype","type","isRulesetLike","accept","visitor","visit","visitArray","genCSS","context","output","add","outputRuleset","eval","mediaBlocks","mediaPath","media","debugInfo","push","functionRegistry","frames","inherit","unshift","shift","pop","length","evalTop","evalNested","result","getIndex","fileInfo","multiMedia","i","path","concat","permute","map","fragment","toCSS","splice","arr","rest","slice","j","bubbleSelectors","copyArray"],"mappings":"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","file":"../../../engine/tree/media.js","sourcesContent":["define([\n    './ruleset',\n    './value',\n    './selector',\n    './anonymous',\n    './expression',\n    './atrule',\n    '../utils'\n], function (__module__0, __module__1, __module__2, __module__3, __module__4, __module__5, __module__6) {\n    'use strict';\n    var exports = {};\n    var module = { exports: {} };\n    var Ruleset = __module__0, Value = __module__1, Selector = __module__2, Anonymous = __module__3, Expression = __module__4, AtRule = __module__5, utils = __module__6;\n    var Media = function (value, features, index, currentFileInfo, visibilityInfo) {\n        this._index = index;\n        this._fileInfo = currentFileInfo;\n        var selectors = new Selector([], null, null, this._index, this._fileInfo).createEmptySelectors();\n        this.features = new Value(features);\n        this.rules = [new Ruleset(selectors, value)];\n        this.rules[0].allowImports = true;\n        this.copyVisibilityInfo(visibilityInfo);\n        this.allowRoot = true;\n        this.setParent(selectors, this);\n        this.setParent(this.features, this);\n        this.setParent(this.rules, this);\n    };\n    Media.prototype = new AtRule();\n    Media.prototype.type = 'Media';\n    Media.prototype.isRulesetLike = function () {\n        return true;\n    };\n    Media.prototype.accept = function (visitor) {\n        if (this.features) {\n            this.features = visitor.visit(this.features);\n        }\n        if (this.rules) {\n            this.rules = visitor.visitArray(this.rules);\n        }\n    };\n    Media.prototype.genCSS = function (context, output) {\n        output.add('@media ', this._fileInfo, this._index);\n        this.features.genCSS(context, output);\n        this.outputRuleset(context, output, this.rules);\n    };\n    Media.prototype.eval = function (context) {\n        if (!context.mediaBlocks) {\n            context.mediaBlocks = [];\n            context.mediaPath = [];\n        }\n        var media = new Media(null, [], this._index, this._fileInfo, this.visibilityInfo());\n        if (this.debugInfo) {\n            this.rules[0].debugInfo = this.debugInfo;\n            media.debugInfo = this.debugInfo;\n        }\n        media.features = this.features.eval(context);\n        context.mediaPath.push(media);\n        context.mediaBlocks.push(media);\n        this.rules[0].functionRegistry = context.frames[0].functionRegistry.inherit();\n        context.frames.unshift(this.rules[0]);\n        media.rules = [this.rules[0].eval(context)];\n        context.frames.shift();\n        context.mediaPath.pop();\n        return context.mediaPath.length === 0 ? media.evalTop(context) : media.evalNested(context);\n    };\n    Media.prototype.evalTop = function (context) {\n        var result = this;\n        if (context.mediaBlocks.length > 1) {\n            var selectors = new Selector([], null, null, this.getIndex(), this.fileInfo()).createEmptySelectors();\n            result = new Ruleset(selectors, context.mediaBlocks);\n            result.multiMedia = true;\n            result.copyVisibilityInfo(this.visibilityInfo());\n            this.setParent(result, this);\n        }\n        delete context.mediaBlocks;\n        delete context.mediaPath;\n        return result;\n    };\n    Media.prototype.evalNested = function (context) {\n        var i, value, path = context.mediaPath.concat([this]);\n        for (i = 0; i < path.length; i++) {\n            value = path[i].features instanceof Value ? path[i].features.value : path[i].features;\n            path[i] = Array.isArray(value) ? value : [value];\n        }\n        this.features = new Value(this.permute(path).map(function (path) {\n            path = path.map(function (fragment) {\n                return fragment.toCSS ? fragment : new Anonymous(fragment);\n            });\n            for (i = path.length - 1; i > 0; i--) {\n                path.splice(i, 0, new Anonymous('and'));\n            }\n            return new Expression(path);\n        }));\n        this.setParent(this.features, this);\n        return new Ruleset([], []);\n    };\n    Media.prototype.permute = function (arr) {\n        if (arr.length === 0) {\n            return [];\n        } else if (arr.length === 1) {\n            return arr[0];\n        } else {\n            var result = [];\n            var rest = this.permute(arr.slice(1));\n            for (var i = 0; i < rest.length; i++) {\n                for (var j = 0; j < arr[0].length; j++) {\n                    result.push([arr[0][j]].concat(rest[i]));\n                }\n            }\n            return result;\n        }\n    };\n    Media.prototype.bubbleSelectors = function (selectors) {\n        if (!selectors) {\n            return;\n        }\n        this.rules = [new Ruleset(utils.copyArray(selectors), [this.rules[0]])];\n        this.setParent(this.rules, this);\n    };\n    module.exports = Media;\n    function __isEmptyObject(obj) {\n        var attr;\n        for (attr in obj)\n            return !1;\n        return !0;\n    }\n    function __isValidToReturn(obj) {\n        return typeof obj != 'object' || Array.isArray(obj) || !__isEmptyObject(obj);\n    }\n    if (__isValidToReturn(module.exports))\n        return module.exports;\n    else if (__isValidToReturn(exports))\n        return exports;\n});"]}